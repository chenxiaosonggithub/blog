# nfs简介

Nfs介绍，维基百科

```sh
      OSI            TCP/IP
  +------------+  +------------+
 7|application |  |            |
  |   layer    |  |            |
  +------------+  |            |
  +------------+  |            |
 6|presentation| 4|application | sunrpc
  |   layer    |  |    layer   |
  +------------+  |            |
  +------------+  |            |
 5|   session  |  |            |
  |   layer    |  |            |
  +------------+  +------------+
  +------------+  +------------+
 4| transport  | 3| transport  | tcp
  |   layer    |  |   layer    |
  +------------+  +------------+
  +------------+  +------------+
 3|  network   | 2| internet   | ip
  |   layer    |  |   layer    |
  +------------+  +------------+
  +------------+  +------------+
 2|  data link |  |            |
  |   layer    | 1|  network   |
  +------------+  |  access    |
  +------------+  |   layer    |
 1|  physical  |  |(link layer)|
  |   layer    |  |            |
  +------------+  +------------+
```

Client app/storage, nfs/nfsd, ppc, tcp

怎么用，

Nfs各版本比较

文件句柄， fh_compose, knfsd_fh, 

Clientid, 反向通道

```sh
                                +---------+
                                |         |
                                | client2 |<--------+
                                |         |         |
                                +---------+         |
                                  |     ^           |
                            1.OPEN|     |           |
                                  |     |           |
                                  | 2.NFS4ERR_DELAY |
                                  v     |           |
+---------+                     +---------+         |
|         |<---3.CB_RECALL------|         |         |
| client1 |----4.ok------------>| server  |--7.ok---+
|         |----5.DELEGRETURN--->|         |
|         |<---6.ok-------------|         |
+---------+                     +---------+
```

delegation机制，冲突处理图

Nfs文件锁，NLM，

Pnfs，网络结构图

```sh
+---------+                                          
|+---------+                                         
||+---------+                             +---------+
|||         |            pNFS             |         |
+|| clients |<--------------------------->| server  |
 +|         |                             |         |
  +---------+                             +---------+
      ^^^                                      ^     
      |||                                      |     
      |||                                      |     
      |||                                      |     
      |||                                      |     
      ||| storage                              |     
      ||| protocol   +---------+               |     
      ||+----------->|+---------+              |     
      |+------------>||+---------+  control    |
      +------------->|||         |  protocol   |
                     ||| storage |<------------+
                     +|| devices |      
                      +|         |      
                       +---------+                   
```