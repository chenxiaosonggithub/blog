[点击这里跳转到陈孝松个人主页:chenxiaosong.com](http://chenxiaosong.com/)。

虽说接触NFS也有两年多了，但对RFC协议也只是偶尔查阅，没有系统的看过。最近公司鼓励我多做一些社区特性开发，就想着借助ChatGPT边翻译边学习，顺便记录下来，方便后继查阅。

本文章翻译自文档[rfc8881, August 2020, Network File System (NFS) Version 4 Minor Version 1 Protocol](https://www.rfc-editor.org/rfc/rfc8881)，大部分借助于ChatGPT翻译，仅作为我个人的参考，如果你想查阅，建议看英文文档，因为我不确定我记录的中文翻译是否完整和正确。

持续更新中。。。

# 摘要

本文描述了网络文件系统（NFS）版本4的次版本1，包括从基础协议（在RFC 7530中指定的NFS版本4的次版本0）保留的特性以及随后进行的协议扩展。后续的次版本不依赖于NFS版本4的次版本0，并被视为一个独立的协议。

本文废弃了RFC 5661。它在很大程度上修改了与多服务器命名空间相关的特性的处理，取代了在RFC 5661中出现的对这些特性的描述。

# 文档状态

本文档是一份Internet标准跟踪文件。

本文是Internet工程任务组（IETF）的成果。它代表了IETF社区的共识。经过公开审查，并已获得Internet工程指导组（IESG）批准发布。有关Internet标准的更多信息，请参阅RFC 7841的第2节。

有关本文档当前状态、任何勘误以及如何提供反馈意见的信息，请访问https://www.rfc-editor.org/info/rfc8881。

# 版权声明

版权（c）2020 IETF信托和被确认为文档作者的人。保留所有权利。

本文受到BCP 78和IETF信托的与IETF文档相关的法律规定（https://trustee.ietf.org/license-info）的约束，该法规在本文档发布日期生效。请仔细阅读这些文件，因为它们描述了您对本文档的权利和限制。从本文档中提取的代码组件必须包含简化的BSD许可证文本，如信托法规的第4.e节所述，并且按照简化的BSD许可证描述的无任何保证提供。

本文可能包含在2008年11月10日之前发布或公开提供的IETF文档或IETF贡献的材料。在一些此类材料的版权控制人可能未授予IETF信托修改此类材料的权利的情况下，本文可能无法在IETF标准过程之外进行修改，并且除了将其格式化为RFC的出版物或将其翻译成英语以外，可能无法在IETF标准过程之外创建其衍生作品。

# 1. 引言

## 1.1. 介绍此更新

在次版本0中先前定义但在次版本1中从未完全解决的两个重要特性是干线化（trunking）和透明状态迁移（Transparent State Migration）。干线化是指在客户端和服务器之间同时使用多个连接，可能连接到不同的网络地址；透明状态迁移允许以一种方式将文件系统传输到另一台服务器，从而使客户端能够在传输过程中保持其现有的锁定状态。

此更新中提供的对NFS版本4次版本1（NFSv4.1）协议的修订描述是为了允许与其他多服务器命名空间特性一起充分使用这些功能。本文以更新的形式呈现了先前在RFC 5661 [66]中定义的NFSv4.1协议的描述。RFC 5661被本文所废弃。然而，此更新的范围有限，重点是允许充分使用干线化和透明状态迁移。对这些更改的需求在附录A中进行了讨论。附录B描述了到达当前文本所做的具体更改。

这个有限范围的更新替换了当前的NFSv4.1 RFC，旨在提供一份权威且完整的规范，其动机在[36]中进行了讨论，解决了更新范围内的问题。但是，它将不解决已知但超出此有限范围的问题，正如可以预期的协议的完整更新。以下是已知需要在协议的将来更新中解决的一些领域：

需要就RFC 8178 [67]进行工作，该RFC建立了NFSv4的版本规则。由于RFC 5661目前与该文档不一致，因此需要进行更改，以便在不需要RFC 8178更新NFSv4.1规范的情况下达到一种情况。

需要对RFC 8434 [70]进行工作，该RFC建立了并行NFS（pNFS）布局类型的要求，而RFC 5661中没有明确定义。当完成该工作并获得批准的结果文件时，新的NFSv4.1规范文件将提供一组清晰的布局类型要求，并描述符合这些要求的文件布局类型。其他布局类型将有它们自己符合这些要求的规范文件。

需要进行工作以处理与RFC 5661相关的许多勘误报告，除了本文档中处理的勘误报告2006 [64]。由于所建议的更改与那里提出的更改的交互作用以及新描述的状态和会话迁移的处理，因此必须进行处理。

在稍后的文档中需要解决已推迟的并且将需要处理的勘误报告，其中包括在勘误报告系统中分配了一系列状态的报告，包括标记为“已接受”的报告和标记为“保留以进行文档更新”的报告，因为更改太小而无法立即解决。

此外，还有一组其他报告，其中至少有一个处于拒绝状态，将需要在稍后的文档中进行处理。这将涉及对RFC 5661中反映的共识决策进行更改，情况是工作组已决定RFC 5661中的处理不正确并需要修订以反映工作组的新共识，并确保与不遵循RFC 5661中描述的处理的现有实现兼容。

请注意，尽管此文档废弃了RFC 5661 [66]，但预计所有这些勘误报告将始终与实施者和最终的rfc5661bis的作者相关，尽管此文档废弃了RFC 5661 [66]。

有必要对国际化的描述采取新方法，因为当前的国际化部分（第14节）从未被实施，并且不符合NFSv4协议的需求。可能的解决方案是创建一个基于[68]中的国际化部分的新国际化部分，或者创建一个描述所有NFSv4次版本的国际化的新文档，并在定义NFSv4.0和NFSv4.1的RFC时引用该文档。

需要对NFSv4.1中的安全性进行修订处理。有关现有处理的问题在附录C中进行了讨论。

在进行上述工作之前，将无法提供一致的文档集来描述NFSv4.1协议，并且任何全面的描述都将涉及在规范内更新其他文档。RFC 8434 [70]和RFC 8178 [67]对RFC 5661的更新也适用于此规范，并且将适用于任何随后的v4.1规范，直到完成这项工作。

## 1.2 NFS版本4 次版本1 协议

NFS版本4 次版本1（NFSv4.1）协议是NFS版本4（NFSv4）协议的第二个次版本。第一个次版本，NFSv4.0，现在在RFC 7530 [68]中进行了描述。它通常遵循RFC 3530 [37]第10节中列出的次版本化指南。然而，它与指南11（“支持次版本X的客户端和服务器必须支持次版本0到X-1”）和指南12（“不得在次版本中引入新功能作为强制性要求”）有所偏离。这些偏离是由于引入了用于管理非幂等操作和RECLAIM_COMPLETE操作的会话模型。这两个新功能在性质上是基础性的，简化了现有功能和其他新功能的实现。将它们定义为除了REQUIRED之外的任何内容都会给协议定义和实现增加不必要的复杂性。因此，NFSv4.1更新了次版本化指南（第2.7节）。

作为一个次版本，NFSv4.1与NFSv4的总体目标一致，但通过根据对NFSv4.0的经验扩展协议以更好地实现这些目标。此外，NFSv4.1还采纳了一些额外的目标，这些目标激发了NFSv4.1中的一些重大扩展。

## 1.3 要求语言

本文档中的关键词“MUST”、“MUST NOT”、“REQUIRED”、“SHALL”、“SHALL NOT”、“SHOULD”、“SHOULD NOT”、“RECOMMENDED”、“MAY”和“OPTIONAL”应按照RFC 2119 [1]中的描述进行解释。

## 1.4 本文档范围

本文档描述了NFSv4.1协议。与NFSv4.0相关的，本文档不包括：

- 描述NFSv4.0协议，除非需要与NFSv4.1进行对比。
- 修改NFSv4.0协议的规范。
- 阐明NFSv4.0协议。

# todo: 1.5. NFSv4 Goals

# 2.10. 会话

NFSv4.1 客户端和服务器必须支持并必须使用本节描述的会话功能。

## 2.10.1. 动机和概述

以前的 NFS 版本和次要版本存在以下问题：

- 不支持“仅一次语义”（EOS）。这包括通过服务器故障和恢复对 EOS 的支持不足。
- 有限的回调支持，包括不支持通过防火墙发送回调以及正常请求和回调之间的竞争。
- 通过多个网络路径的有限干线支持。
- 对于完全安全的操作需要机器凭据。

通过引入会话，NFSv4.1通过实际的解决方案解决了上述不足之处：

- 通过具有有界大小的回复缓存启用 EOS，使得将缓存保留在持久存储中并通过服务器故障和恢复启用 EOS 成为可能。以前的 NFS 版本之所以不支持 EOS 的一个原因是因为一些 EOS 方法通常限制了并行性。如第 2.10.6 节所述，NFSv4.1 同时支持 EOS 和无限制的并行性。
- NFSv4.1 客户端（在第 1.7 节中定义）创建传输连接并将其提供给服务器以用于发送回调请求，从而解决了防火墙问题（第 18.34 节）。通过会话的排序属性检测到由请求引起的来自客户端请求和回调之间的竞争（第 2.10.6.3 节）。
- NFSv4.1 客户端可以将任意数量的连接与会话关联起来，从而提供干线（第 2.10.5 节）。
- NFSv4.1 客户端和服务器生成与客户端和服务器机器凭据无关的会话密钥，可用于计算用于保护关键会话管理操作的摘要（第 2.10.8.3 节）。
- NFSv4.1 客户端还可以为会话的反向通道创建不需要服务器对客户端机器主体进行身份验证的安全 RPCSEC_GSS 上下文（第 2.10.8.2 节）。

一个会话是由客户端动态创建的，长时间存在的服务器对象，可在一段时间内从一个或多个传输连接中使用。其功能是维护相对于属于客户端实例的一个或多个连接的服务器状态。该状态完全独立于连接本身，实际上，该状态存在与连接存在与否无关。客户端可能与之关联一个或多个会话，以便可以使用与该客户端的客户端 ID 关联的任何会话来访问客户端相关状态，当连接与那些会话关联时。当任何客户端 ID 的会话在较长时间内未关联任何连接时，诸如锁定、打开、授权、布局等对象都可能过期。该会话充当一个对象，表示客户端访问服务器上关联客户端状态的一种手段，独立于访问该状态的物理手段。

一个客户端可以创建多个会话。一个会话不能为多个客户端提供服务。

# todo: 2.10.2. NFSv4 Integration