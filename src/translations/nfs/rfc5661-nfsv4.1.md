[点击这里跳转到陈孝松个人主页:chenxiaosong.com](http://chenxiaosong.com/)。

虽说接触NFS也有两年多了，但对RFC协议也只是偶尔查阅，没有系统的看过。最近公司鼓励我多做一些社区特性开发，就想着借助ChatGPT边翻译边学习，顺便记录下来，方便后继查阅。

持续更新中。。。

本文章翻译自文档[Network File System (NFS) Version 4 Minor Version 1 Protocol](https://www.rfc-editor.org/rfc/rfc5661.html)。

# 摘要

该文档描述了网络文件系统（Network File System，NFS）第 4 版次的次要版本 1，其中包括从基础协议（NFS 第 4 版次的次要版本 0，在 RFC 3530 中指定）保留的功能以及随后进行的协议扩展。在 NFS 第 4 版次的次要版本 1 中引入的主要扩展包括会话（Sessions）、目录委托（Directory Delegations）和并行 NFS（pNFS）。NFS 第 4 版次的次要版本 1 不依赖于 NFS 第 4 版次的次要版本 0，被视为一个独立的协议。因此，该文档既不更新也不废除 RFC 3530。NFS 第 4 版次的次要版本 1 被认为优于 NFS 第 4 版次的次要版本 0，而且在功能上没有损失，更推荐使用版本 1。NFS 的第 4 版次的次要版本 0 和 1 可以同时在同一网络、同一客户端和服务器之间使用。

# 文档状态

本文是一份互联网标准跟踪文件。

该文档是由互联网工程任务组（IETF）的成果。它代表了IETF社区的共识。已经接受了公开审查，并已获得互联网工程指导组（IESG）的批准发表。有关互联网标准的更多信息，请参见[RFC 5741](https://www.rfc-editor.org/rfc/rfc5741.html)的第2节。

有关本文档的当前状态、任何勘误以及如何提供反馈的信息可在 http://www.rfc-editor.org/info/rfc5661 获取。

# 版权声明

版权所有 (c) 2010 IETF信托及被确认为本文档作者的个人。 保留所有权利。

本文档受到BCP 78和IETF信托文件相关的法律规定的约束(http://trustee.ietf.org/license-info)，适用于本文档发布之日。请仔细阅读这些文件，因为它们描述了您对本文档的权利和限制。从本文档中提取的代码组件必须包含在信托法规定的简化BSD许可证文本中，如信托法规定的第4.e节所述，并且按照简化BSD许可证描述的方式提供，不附带任何保证。

# 1. 引言

## 1.1. NFS版本4小版本1协议

NFS版本4小版本1（NFSv4.1）协议是NFS版本4（NFSv4）协议的第二个小版本。第一个小版本，NFSv4.0，在[30]中有描述。它通常遵循RFC 3530第10节列出的小版本控制的准则。然而，它在第11条（“支持小版本X的客户端和服务器必须支持小版本0到X-1”）和第12条（“在小版本中不能引入新的强制性特性”）准则方面存在分歧。这些分歧是由于引入了用于管理非幂等操作和RECLAIM_COMPLETE操作的会话模型。这两个新特性在基础结构上，简化了对现有特性和其他新特性的实现。将它们定义为非必需的将给协议的定义和实现增加不必要的复杂性。因此，NFSv4.1更新了小版本控制的准则（第2.7节）。

作为一个小版本，NFSv4.1与NFSv4的总体目标一致，但通过根据NFSv4.0的经验扩展协议，以更好地实现这些目标。此外，NFSv4.1还采用了一些额外的目标，这些目标激发了NFSv4.1中一些主要扩展的动机。

## 1.2. 要求语言

本文档中的关键词 "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", 和 "OPTIONAL" 应被解释为 RFC 2119 [1] 中所描述的。

## 1.3. 本文档的范围

本文档描述了NFSv4.1协议。相对于NFSv4.0，本文档不包括：

o 描述NFSv4.0协议，除非需要与NFSv4.1进行对比。

o 修改NFSv4.0协议的规范。

o 澄清NFSv4.0协议。

## 1.4. NFSv4 目标

NFSv4 协议是对已由 NFSv3 [31] 定义的 NFS 协议的进一步修订。它保留了先前版本的基本特征：易于恢复、独立于传输协议、操作系统和文件系统、简单性和良好性能。NFSv4 具有以下目标：

○ 在互联网上提供更好的访问和性能：该协议设计为在防火墙中轻松传输，在延迟高、带宽低的情况下表现良好，并能扩展到每个服务器上的大量客户端。

○ 具备协商的强大安全性：该协议在 ONCRPC 工作组的基础上支持 RPCSEC_GSS 协议。此外，NFSv4.1 协议提供了一种机制，允许客户端和服务器协商安全性，并要求客户端和服务器支持一组最小的安全方案。

○ 良好的跨平台互操作性：该协议具有一个文件系统模型，提供了一组有用的公共特性，不会过分偏向一个文件系统或操作系统而忽略另一个。

○ 设计用于协议扩展：该协议被设计为在一个允许并鼓励向后兼容的框架内接受标准扩展。

## 1.5. NFSv4.1 目标

NFSv4.1 在整体NFSv4目标的框架内具有以下目标。

○ 纠正在基本协议中发现的重大结构性弱点和疏漏。

○ 在基本协议中未解决或未详细解决的领域中增加清晰度和具体性。然而，正如第1.3节所述，NFSv4.1 规范中不澄清 NFSv4.0 协议是一个目标。

○ 基于对现有协议的经验和最近的行业发展，增加具体的特性。

○ 提供协议支持，以利用集群服务器部署，包括提供对分布在多个服务器之间的文件的可伸缩并行访问的能力。

## 1.6. 通用定义

以下定义为读者提供了适当的上下文。

字节（Byte）：在本文档中，字节是一个八位组，即一个长度为8位的数据。

客户端（Client）：客户端是访问NFS服务器资源的实体。客户端可以是直接访问NFS服务器的逻辑应用程序，也可以是为一组应用程序提供远程文件系统服务的传统操作系统客户端。

客户端由客户端所有者唯一标识。

在字节范围锁定方面，客户端还是代表一个或多个应用程序维护锁定集的实体。这个客户端负责对其管理的锁进行崩溃或失败的恢复。

请注意，多个客户端可以共享相同的传输和连接，而且多个客户端可以存在于同一网络节点上。

客户端ID（Client ID）：客户端ID是一个64位的数量，用作对客户端提供的验证器和客户端所有者的唯一简便引用。服务器负责提供客户端ID。

客户端所有者（Client Owner）：客户端所有者是一个对服务器来说是不透明的唯一字符串，用于标识客户端。可能共享客户端所有者的多个网络连接和来自这些连接的源网络地址。服务器预期将具有相同客户端所有者的连接的请求视为来自同一客户端。

文件系统（File System）：文件系统是服务器上的对象集合（由服务器所有者的主标识符标识，稍后在本节中定义），这些对象具有相同的fsid属性（参见第5.8.1.9节）。

租约（Lease）：租约是服务器为客户端定义的一个时间间隔，客户端在此时间间隔内被不可撤销地授予锁。在租约期结束时，如果租约未被延长，锁可能会被撤销。如果在租约间隔之后授予了冲突的锁，则必须撤销锁。

服务器为客户端提供单个租约以用于所有状态。

锁（Lock）：术语“锁”用于指代字节范围（在UNIX环境中也称为记录）锁、共享预留、委派或布局，除非另有明确说明。

秘密状态验证器（SSV）：SSV是客户端和服务器之间共享的唯一秘密密钥。SSV充当NFSv4.1内部（即，对NFSv4.1内部）通用安全服务（GSS）机制（即SSV GSS机制；参见第2.10.9节）的密钥。SSV GSS机制使用SSV计算消息完整性代码（MIC）和Wrap令牌。有关NFSv4.1如何使用SSV和SSV GSS机制的更多详细信息，请参见第2.10.8.3节。

服务器（Server）：服务器是负责协调客户端访问一组文件系统的实体，并由服务器所有者标识。服务器可以跨越多个网络地址。

服务器所有者（Server Owner）：服务器所有者标识服务器对客户端。服务器所有者由主标识符和次要标识符组成。当客户端对等方的两个连接都具有相同的主标识符时，客户端假定两个对等方都是同一服务器（服务器命名空间通过每个连接相同），并且锁状态可以跨两个连接共享。当每个对等方都具有相同的主和次要标识符时，客户端假定每个连接可能与相同的会话相关联。

稳定存储（Stable Storage）：稳定存储是NFSv4.1服务器的数据可以从多次电源故障（包括级联的电源故障，即快速相继发生的多次电源故障）、操作系统故障和/或存储介质本身（例如磁盘、非易失性RAM、闪存存储器等）的硬件故障中恢复而不会丢失数据的存储。一些NFS服务器允许的稳定存储的示例包括：

数据的媒体提交；即修改的数据已成功写入磁盘介质，例如磁盘盘片。

带有电池备份的即时回复磁盘驱动器，具有驱动器上的中间存储或不间断电源系统（UPS）。

具有电池备份的中间存储和恢复软件的数据服务器提交。

具有不间断电源系统（UPS）和恢复软件的缓存提交。

状态ID（Stateid）：状态ID是服务器返回的一个128位数量，唯一定义了服务器为特定的打开所有者或锁所有者/打开所有者对提供的特定文件和锁类型所提供的打开和锁定状态。

验证器（Verifier）：验证器是由客户端生成的一个64位数量，服务器可以使用它来确定客户端是否已重新启动并丢失了所有先前的锁定状态。

todo:1.7.  Overview of NFSv4.1 Features