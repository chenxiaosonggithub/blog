From 165533c38b84ee1a42d5113446ba08bca5a00d08 Mon Sep 17 00:00:00 2001
From: ChenXiaoSong <chenxiaosong@kylinos.cn>
Date: Fri, 12 Dec 2025 12:54:58 +0800
Subject: [PATCH] smb: stat smb2maperror comparison count

Signed-off-by: ChenXiaoSong <chenxiaosong@kylinos.cn>
---
 fs/smb/client/smb2maperror.c      |  4 ++++
 fs/smb/client/smb2maperror_test.c | 10 +++++-----
 2 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/fs/smb/client/smb2maperror.c b/fs/smb/client/smb2maperror.c
index de5b97e5808e..1e3ed56d63d9 100644
--- a/fs/smb/client/smb2maperror.c
+++ b/fs/smb/client/smb2maperror.c
@@ -16,6 +16,8 @@
 #include "../common/smb2status.h"
 #include "trace.h"
 
+static int cmp_count = 0;
+
 static struct status_to_posix_error smb2_error_map_table[] = {
 #include "smb2_mapping_table.c"
 };
@@ -27,6 +29,8 @@ static int cmp_smb2_status(const void *_a, const void *_b)
 {
 	const struct status_to_posix_error *a = _a, *b = _b;
 
+	cmp_count++;
+	printk("%s, err_map_num:%d, cmp_count:%d\n", __func__, err_map_num, cmp_count);
 	if (a->smb2_status < b->smb2_status)
 		return -1;
 	if (a->smb2_status > b->smb2_status)
diff --git a/fs/smb/client/smb2maperror_test.c b/fs/smb/client/smb2maperror_test.c
index b807a860ca59..94aabe31e317 100644
--- a/fs/smb/client/smb2maperror_test.c
+++ b/fs/smb/client/smb2maperror_test.c
@@ -42,13 +42,13 @@ test_cmp_map(struct kunit *test, struct status_to_posix_error *expect)
 
 static void maperror_test_check_search(struct kunit *test)
 {
-	unsigned int i;
+	unsigned int i = err_map_num - 1;
 	struct status_to_posix_error expect;
 
-	for (i = 0; i < err_map_num; i++) {
-		expect = smb2_error_map_table[i];
-		test_cmp_map(test, &expect);
-	}
+	cmp_count = 0;
+	expect = smb2_error_map_table[i];
+	test_cmp_map(test, &expect);
+	printk("%s, err_map_num:%d, cmp_count:%d\n", __func__, err_map_num, cmp_count);
 }
 
 /*
-- 
2.43.0

