From f8de545710d4782d501b7af85c4f726fa2a510fe Mon Sep 17 00:00:00 2001
From: ChenXiaoSong <chenxiaosong@kylinos.cn>
Date: Fri, 12 Dec 2025 12:54:58 +0800
Subject: [PATCH] smb: stat smb2maperror comparison count

Signed-off-by: ChenXiaoSong <chenxiaosong@kylinos.cn>
---
 fs/smb/client/smb2maperror.c      |  4 ++++
 fs/smb/client/smb2maperror_test.c | 10 +++++-----
 2 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/fs/smb/client/smb2maperror.c b/fs/smb/client/smb2maperror.c
index fe77fb494adb..f7fb871ffb48 100644
--- a/fs/smb/client/smb2maperror.c
+++ b/fs/smb/client/smb2maperror.c
@@ -16,6 +16,8 @@
 #include "../common/smb2status.h"
 #include "trace.h"
 
+static int cmp_count = 0;
+
 static const struct status_to_posix_error smb2_error_map_table[] = {
 /* Automatically generated by the `gen_smb2_mapping` script */
 #include "smb2_mapping_table.c"
@@ -28,6 +30,8 @@ static int cmp_smb2_status(const void *_a, const void *_b)
 {
 	const struct status_to_posix_error *a = _a, *b = _b;
 
+	cmp_count++;
+	printk("%s, err_map_num:%d, cmp_count:%d\n", __func__, err_map_num, cmp_count);
 	if (a->smb2_status < b->smb2_status)
 		return -1;
 	if (a->smb2_status > b->smb2_status)
diff --git a/fs/smb/client/smb2maperror_test.c b/fs/smb/client/smb2maperror_test.c
index 32865aebf20f..b2bc53906069 100644
--- a/fs/smb/client/smb2maperror_test.c
+++ b/fs/smb/client/smb2maperror_test.c
@@ -42,13 +42,13 @@ test_cmp_map(struct kunit *test, struct status_to_posix_error *expect)
 
 static void maperror_test_check_search(struct kunit *test)
 {
-	unsigned int i;
+	unsigned int i = err_map_num - 1;
 	struct status_to_posix_error expect;
 
-	for (i = 0; i < err_map_num; i++) {
-		expect = smb2_error_map_table[i];
-		test_cmp_map(test, &expect);
-	}
+	cmp_count = 0;
+	expect = smb2_error_map_table[i];
+	test_cmp_map(test, &expect);
+	printk("%s, err_map_num:%d, cmp_count:%d\n", __func__, err_map_num, cmp_count);
 }
 
 static struct kunit_case maperror_test_cases[] = {
-- 
2.43.0

