From eb59879242ab09f40bb441a40b4592ac8e660050 Mon Sep 17 00:00:00 2001
From: ChenXiaoSong <chenxiaosong@kylinos.cn>
Date: Fri, 12 Dec 2025 12:54:58 +0800
Subject: [PATCH] smb: stat smb2maperror comparison count

Signed-off-by: ChenXiaoSong <chenxiaosong@kylinos.cn>
---
 fs/smb/client/smb2maperror.c      |  4 ++++
 fs/smb/client/smb2maperror_test.c | 10 +++++-----
 2 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/fs/smb/client/smb2maperror.c b/fs/smb/client/smb2maperror.c
index e71ee23400e8..bbe8a3396591 100644
--- a/fs/smb/client/smb2maperror.c
+++ b/fs/smb/client/smb2maperror.c
@@ -22,6 +22,8 @@ struct status_to_posix_error {
 	char *status_string;
 };
 
+static int cmp_count = 0;
+
 static const struct status_to_posix_error smb2_error_map_table[] = {
 /* Automatically generated by the `gen_smb2_mapping` script */
 #include "smb2_mapping_table.c"
@@ -33,6 +35,8 @@ static int cmp_smb2_status(const void *_a, const void *_b)
 {
 	const struct status_to_posix_error *a = _a, *b = _b;
 
+	cmp_count++;
+	printk("%s, err_map_num:%d, cmp_count:%d\n", __func__, err_map_num, cmp_count);
 	if (a->smb2_status < b->smb2_status)
 		return -1;
 	if (a->smb2_status > b->smb2_status)
diff --git a/fs/smb/client/smb2maperror_test.c b/fs/smb/client/smb2maperror_test.c
index bb2ae4f32611..dba458fb68ac 100644
--- a/fs/smb/client/smb2maperror_test.c
+++ b/fs/smb/client/smb2maperror_test.c
@@ -24,13 +24,13 @@ test_cmp_map(struct kunit *test, struct status_to_posix_error *expect)
 
 static void maperror_test_check_search(struct kunit *test)
 {
-	unsigned int i;
+	unsigned int i = err_map_num - 1;
 	struct status_to_posix_error expect;
 
-	for (i = 0; i < err_map_num; i++) {
-		expect = smb2_error_map_table[i];
-		test_cmp_map(test, &expect);
-	}
+	cmp_count = 0;
+	expect = smb2_error_map_table[i];
+	test_cmp_map(test, &expect);
+	printk("%s, err_map_num:%d, cmp_count:%d\n", __func__, err_map_num, cmp_count);
 }
 
 static struct kunit_case maperror_test_cases[] = {
-- 
2.43.0

