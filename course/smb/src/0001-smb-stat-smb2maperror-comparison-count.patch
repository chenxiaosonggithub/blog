From 293d07c88c1f00dd56946a5d9d188c8733591212 Mon Sep 17 00:00:00 2001
From: ChenXiaoSong <chenxiaosong@kylinos.cn>
Date: Fri, 12 Dec 2025 12:54:58 +0800
Subject: [PATCH] smb: stat smb2maperror comparison count

Signed-off-by: ChenXiaoSong <chenxiaosong@kylinos.cn>
---
 fs/smb/client/smb2maperror.c      |  5 +++++
 fs/smb/client/smb2maperror_test.c | 11 ++++++-----
 2 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/fs/smb/client/smb2maperror.c b/fs/smb/client/smb2maperror.c
index b7005f0a9e2c..74635985f0f4 100644
--- a/fs/smb/client/smb2maperror.c
+++ b/fs/smb/client/smb2maperror.c
@@ -22,6 +22,8 @@ struct status_to_posix_error {
 	char *status_string;
 };
 
+static int cmp_count = 0;
+
 static const struct status_to_posix_error smb2_error_map_table[] = {
 /* Automatically generated by the `gen_smb2_mapping` script */
 #include "smb2_mapping_table.c"
@@ -31,6 +33,9 @@ static __always_inline int cmp_smb2_status(const void *_a, const void *_b)
 {
 	const struct status_to_posix_error *a = _a, *b = _b;
 
+	cmp_count++;
+	printk("%s, err_map_num:%ld, cmp_count:%d\n", __func__,
+	       ARRAY_SIZE(smb2_error_map_table), cmp_count);
 	if (a->smb2_status < b->smb2_status)
 		return -1;
 	if (a->smb2_status > b->smb2_status)
diff --git a/fs/smb/client/smb2maperror_test.c b/fs/smb/client/smb2maperror_test.c
index 6ac6cdac623b..4f3d19acb3b4 100644
--- a/fs/smb/client/smb2maperror_test.c
+++ b/fs/smb/client/smb2maperror_test.c
@@ -24,13 +24,14 @@ test_cmp_map(struct kunit *test, struct status_to_posix_error *expect)
 
 static void maperror_test_check_search(struct kunit *test)
 {
-	unsigned int i;
+	unsigned int i = ARRAY_SIZE(smb2_error_map_table) - 1;
 	struct status_to_posix_error expect;
 
-	for (i = 0; i < ARRAY_SIZE(smb2_error_map_table); i++) {
-		expect = smb2_error_map_table[i];
-		test_cmp_map(test, &expect);
-	}
+	cmp_count = 0;
+	expect = smb2_error_map_table[i];
+	test_cmp_map(test, &expect);
+	printk("%s, err_map_num:%ld, cmp_count:%d\n", __func__,
+	       ARRAY_SIZE(smb2_error_map_table), cmp_count);
 }
 
 static struct kunit_case maperror_test_cases[] = {
-- 
2.43.0

