# `1e02c641c3a4 NFSD: Prevent NULL dereference in nfsd4_process_cb_update()`

回调通道参数更新时，如果这时找不到任何的连接，就会触发空指针解引用。

```c
nfsd4_probe_callback
  set_bit(NFSD4_CLIENT_CB_UPDATE,

nfsd4_run_cb_work
  nfsd4_process_cb_update
    ses = NULL
    clear_bit(NFSD4_CLIENT_CB_UPDATE, // 清除标记
    __nfsd4_find_backchannel
    // ses = c->cn_session // 这里不执行
    setup_callback_client
      ses->se_cb_sec.flavor // ses为NULL
```

# `7917f01a286c nfsd: restore callback functionality for NFSv4.0`

因为nfsv4.0时，`__nfsd4_find_backchannel()`肯定返回空且不会解引用`ses`，所以只在解引用之前做判断。

```c
nfsd4_run_cb_work
  nfsd4_process_cb_update
    ses = NULL
    clear_bit(NFSD4_CLIENT_CB_UPDATE, // 清除标记
    __nfsd4_find_backchannel
    // ses = c->cn_session // 这里不执行
    setup_callback_client
      if (!conn->cb_xprt || !ses) // 在解引用之前判断ses是否为空
      ses->se_cb_sec.flavor // ses为NULL
```

